!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.SiriWave=e()}(this,function(){"use strict";function t(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function e(t,e){for(var a=0;a<e.length;a++){var i=e[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function a(t,a,i){return a&&e(t.prototype,a),i&&e(t,i),t}function n(t,e,a){return t*(1-a)+e*a}function r(t,e){return e={exports:{}},t(e,e.exports),e.exports}for(var i=function(){function e(a){t(this,e),this.ctrl=a.ctrl,this.definition=a.definition,this.ATT_FACTOR=4,this.GRAPH_X=2,this.AMPLITUDE_FACTOR=.6}return a(e,[{key:"_globalAttFn",value:function(t){return Math.pow(this.ATT_FACTOR/(this.ATT_FACTOR+Math.pow(t,this.ATT_FACTOR)),this.ATT_FACTOR)}},{key:"_xpos",value:function(t){return this.ctrl.width*((t+this.GRAPH_X)/(2*this.GRAPH_X))}},{key:"_ypos",value:function(t){return this.AMPLITUDE_FACTOR*this._globalAttFn(t)*this.ctrl.heightMax*this.ctrl.amplitude*(1/this.definition.attenuation)*Math.sin(this.ctrl.opt.frequency*t-this.ctrl.phase)}},{key:"draw",value:function(){var t=this.ctrl.ctx;t.moveTo(0,0),t.beginPath();var e=this.ctrl.color.replace(/rgb\(/g,"").replace(/\)/g,"");t.strokeStyle="rgba("+e+","+this.definition.opacity+")",t.lineWidth=this.definition.lineWidth;for(var a=-this.GRAPH_X;a<=this.GRAPH_X;a+=this.ctrl.opt.pixelDepth)t.lineTo(this._xpos(a),this.ctrl.heightMax+this._ypos(a));t.stroke()}}],[{key:"getDefinition",value:function(){return[{attenuation:-2,lineWidth:1,opacity:.1},{attenuation:-6,lineWidth:1,opacity:.2},{attenuation:4,lineWidth:1,opacity:.4},{attenuation:2,lineWidth:1,opacity:.6},{attenuation:1,lineWidth:1.5,opacity:1}]}}]),e}(),o=n,s=function(){function e(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t(this,e),this.ctrl=a.ctrl,this.definition=a.definition,this.GRAPH_X=25,this.AMPLITUDE_FACTOR=.8,this.SPEED_FACTOR=1,this.DEAD_PX=2,this.ATT_FACTOR=4,this.DESPAWN_FACTOR=.02,this.NOOFCURVES_RANGES=[2,5],this.AMPLITUDE_RANGES=[.3,1],this.OFFSET_RANGES=[-3,3],this.WIDTH_RANGES=[1,3],this.SPEED_RANGES=[.5,1],this.DESPAWN_TIMEOUT_RANGES=[500,2e3],this._respawn()}return a(e,[{key:"_getRandomRange",value:function(t){return t[0]+Math.random()*(t[1]-t[0])}},{key:"_respawnSingle",value:function(t){this.phases[t]=0,this.amplitudes[t]=0,this.despawnTimeouts[t]=this._getRandomRange(this.DESPAWN_TIMEOUT_RANGES),this.offsets[t]=this._getRandomRange(this.OFFSET_RANGES),this.speeds[t]=this._getRandomRange(this.SPEED_RANGES),this.finalAmplitudes[t]=this._getRandomRange(this.AMPLITUDE_RANGES),this.widths[t]=this._getRandomRange(this.WIDTH_RANGES),this.verses[t]=this._getRandomRange([-1,1])}},{key:"_respawn",value:function(){this.spawnAt=Date.now(),this.noOfCurves=Math.floor(this._getRandomRange(this.NOOFCURVES_RANGES)),this.phases=new Array(this.noOfCurves),this.offsets=new Array(this.noOfCurves),this.speeds=new Array(this.noOfCurves),this.finalAmplitudes=new Array(this.noOfCurves),this.widths=new Array(this.noOfCurves),this.amplitudes=new Array(this.noOfCurves),this.despawnTimeouts=new Array(this.noOfCurves),this.verses=new Array(this.noOfCurves);for(var t=0;t<this.noOfCurves;t++)this._respawnSingle(t)}},{key:"_globalAttFn",value:function(t){return Math.pow(this.ATT_FACTOR/(this.ATT_FACTOR+Math.pow(t,2)),this.ATT_FACTOR)}},{key:"_sin",value:function(t,e){return Math.sin(t-e)}},{key:"_grad",value:function(t,e,a){return t>e&&a>t?1:1}},{key:"_yRelativePos",value:function(t){for(var e=0,a=0;a<this.noOfCurves;a++){var i=4*(-1+a/(this.noOfCurves-1)*2);i+=this.offsets[a];var n=1/this.widths[a],o=t*n-i;e+=Math.abs(this.amplitudes[a]*this._sin(this.verses[a]*o,this.phases[a])*this._globalAttFn(o))}return e/this.noOfCurves}},{key:"_ypos",value:function(t){return this.AMPLITUDE_FACTOR*this.ctrl.heightMax*this.ctrl.amplitude*this._yRelativePos(t)*this._globalAttFn(t/this.GRAPH_X*2)}},{key:"_xpos",value:function(t){return this.ctrl.width*((t+this.GRAPH_X)/(2*this.GRAPH_X))}},{key:"_drawSupportLine",value:function(t){var e=[0,this.ctrl.heightMax,this.ctrl.width,1],a=t.createLinearGradient.apply(t,e);a.addColorStop(0,"transparent"),a.addColorStop(.1,"rgba(255,255,255,.5)"),a.addColorStop(.8,"rgba(255,255,255,.5)"),a.addColorStop(1,"transparent"),t.fillStyle=a,t.fillRect.apply(t,e)}},{key:"draw",value:function(){var t=this.ctrl.ctx;if(t.globalAlpha=.7,t.globalCompositeOperation="lighter",this.definition.supportLine)return this._drawSupportLine(t);for(var e=0;e<this.noOfCurves;e++)this.spawnAt+this.despawnTimeouts[e]<=Date.now()?this.amplitudes[e]-=this.DESPAWN_FACTOR:this.amplitudes[e]+=this.DESPAWN_FACTOR,this.amplitudes[e]=Math.min(Math.max(this.amplitudes[e],0),this.finalAmplitudes[e]),this.phases[e]=(this.phases[e]+this.ctrl.speed*this.speeds[e]*this.SPEED_FACTOR)%(2*Math.PI);for(var a=-1/0,i=[1,-1],n=0;n<i.length;n++){var o=i[n];t.beginPath();for(var s=-this.GRAPH_X;s<=this.GRAPH_X;s+=this.ctrl.opt.pixelDepth){var l=this._xpos(s),r=this._ypos(s);t.lineTo(l,this.ctrl.heightMax-o*r),a=Math.max(a,r)}t.closePath(),t.fillStyle="rgba("+this.definition.color+", 1)",t.strokeStyle="rgba("+this.definition.color+", 1)",t.fill()}a<this.DEAD_PX&&this.prevMaxY>a&&this._respawn(),this.prevMaxY=a}}],[{key:"getDefinition",value:function(){return[{color:"255,255,255",supportLine:!0},{color:"15, 82, 169"},{color:"173, 57, 76"},{color:"48, 220, 155"}]}}]),e}(),l="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},p=r(function(t){(function(){var e,a,i,n,o,s;"undefined"!=typeof performance&&null!==performance&&performance.now?t.exports=function(){return performance.now()}:"undefined"!=typeof process&&null!==process&&process.hrtime?(t.exports=function(){return(e()-o)/1e6},a=process.hrtime,e=function(){var t;return t=a(),1e9*t[0]+t[1]},n=e(),s=1e9*process.uptime(),o=n-s):Date.now?(t.exports=function(){return Date.now()-i},i=Date.now()):(t.exports=function(){return(new Date).getTime()-i},i=(new Date).getTime())}).call(l)}),d="undefined"==typeof window?l:window,u=["moz","webkit"],h="AnimationFrame",c=d["request"+h],f=d["cancel"+h]||d["cancelRequest"+h],m=0;!c&&m<u.length;m++)c=d[u[m]+"Request"+h],f=d[u[m]+"Cancel"+h]||d[u[m]+"CancelRequest"+h];if(!c||!f){var g=0,v=0,y=[],w=1e3/60;c=function(t){if(0===y.length){var e=p(),a=Math.max(0,w-(e-g));g=a+e,setTimeout(function(){var t=y.slice(0);y.length=0;for(var e=0;e<t.length;e++)if(!t[e].cancelled)try{t[e].callback(g)}catch(a){setTimeout(function(){throw a},0)}},Math.round(a))}return y.push({handle:++v,callback:t,cancelled:!1}),v},f=function(t){for(var e=0;e<y.length;e++)y[e].handle===t&&(y[e].cancelled=!0)}}var b=function(t){return c.call(d,t)},_=function(){f.apply(d,arguments)},$=function(t){t||(t=d),t.requestAnimationFrame=c,t.cancelAnimationFrame=f};b.cancel=_,b.polyfill=$;var x=function(){function e(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(t(this,e),this.container=a.container||document.body,this.opt=Object.assign({style:"ios",ratio:window.devicePixelRatio||1,speed:.2,amplitude:1,frequency:6,color:"#fff",cover:!1,width:window.getComputedStyle(this.container).width.replace("px",""),height:window.getComputedStyle(this.container).height.replace("px",""),autostart:!1,pixelDepth:.02,lerpSpeed:.1},a),this.phase=0,this.run=!1,this.speed=Number(this.opt.speed),this.amplitude=Number(this.opt.amplitude),this.width=Number(this.opt.ratio*this.opt.width),this.height=Number(this.opt.ratio*this.opt.height),this.heightMax=Number(this.height/2)-6,this.color="rgb("+this._hex2rgb(this.opt.color)+")",this.interpolation={speed:this.speed,amplitude:this.amplitude},this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.canvas.width=this.width,this.canvas.height=this.height,this.opt.cover===!0?this.canvas.style.width=this.canvas.style.height="100%":(this.canvas.style.width=this.width/this.opt.ratio+"px",this.canvas.style.height=this.height/this.opt.ratio+"px"),this.curves=[],"ios9"===this.opt.style){var n=!0,o=!1,l=void 0;try{for(var p,r=s.getDefinition()[Symbol.iterator]();!(n=(p=r.next()).done);n=!0){var d=p.value;this.curves.push(new s({ctrl:this,definition:d}))}}catch(u){o=!0,l=u}finally{try{n||null==r.return||r.return()}finally{if(o)throw l}}}else{var h=!0,c=!1,f=void 0;try{for(var g,m=i.getDefinition()[Symbol.iterator]();!(h=(g=m.next()).done);h=!0){var v=g.value;this.curves.push(new i({ctrl:this,definition:v}))}}catch(u){c=!0,f=u}finally{try{h||null==m.return||m.return()}finally{if(c)throw f}}}this.container.appendChild(this.canvas),a.autostart&&this.start()}return a(e,[{key:"_hex2rgb",value:function(t){var e=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;t=t.replace(e,function(t,e,a,i){return e+e+a+a+i+i});var a=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return a?parseInt(a[1],16).toString()+","+parseInt(a[2],16).toString()+","+parseInt(a[3],16).toString():null}},{key:"_lerp",value:function(t){return this[t]=o(this[t],this.interpolation[t],this.opt.lerpSpeed),this[t]==this.interpolation[t]&&(this.interpolation[t]=null),this[t]}},{key:"_clear",value:function(){this.ctx.globalCompositeOperation="destination-out",this.ctx.fillRect(0,0,this.width,this.height),this.ctx.globalCompositeOperation="source-over"}},{key:"_draw",value:function(){var t=!0,e=!1,a=void 0;try{for(var n,i=this.curves[Symbol.iterator]();!(t=(n=i.next()).done);t=!0){var o=n.value;o.draw()}}catch(s){e=!0,a=s}finally{try{t||null==i.return||i.return()}finally{if(e)throw a}}}},{key:"_startDrawCycle",value:function(){this.run!==!1&&(this._clear(),this.interpolation.amplitude&&this._lerp("amplitude"),this.interpolation.speed&&this._lerp("speed"),this._draw(),this.phase=(this.phase+Math.PI/2*this.speed)%(2*Math.PI),b(this._startDrawCycle.bind(this),20))}},{key:"start",value:function(){this.phase=0,this.run=!0,this._startDrawCycle()}},{key:"stop",value:function(){this.phase=0,this.run=!1}},{key:"set",value:function(t,e){this.interpolation[t]=Number(e)}},{key:"setSpeed",value:function(t){this.set("speed",t)}},{key:"setAmplitude",value:function(t){this.set("amplitude",t)}}]),e}();return x});